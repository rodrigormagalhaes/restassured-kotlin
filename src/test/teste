package clients.mib

import base.BaseTest
import io.qameta.allure.Allure
import io.restassured.response.Response
import io.restassured.module.kotlin.extensions.Given
import io.restassured.module.kotlin.extensions.When
import io.restassured.module.kotlin.extensions.Then
import java.io.ByteArrayInputStream

object MibClient {

    private val baseUrl = BaseTest.config.mib.baseUrl

    fun getAvailableProducts(
        headers: Map<String, String> = emptyMap(),
        acceptVersion: String = "v2"
    ): Response {

        val defaultHeaders = mapOf(
            "accept" to "application/vnd.xxx.mib-insurance.$acceptVersion+json",
            "x-user-id" to "123",
            "x-app-version" to "123.123.555",
            "x-user-type" to "pj"
        )

        val finalHeaders = defaultHeaders + headers

        val response = Given {
            baseUri(baseUrl)
            headers(finalHeaders)
        } When {
            get("/platform/products")
        } Then {
            // sem validação aqui
        }.extract().response()

        Allure.addAttachment(
            "Response Body",
            "application/json",
            ByteArrayInputStream(response.asByteArray()),
            ".json"
        )

        return response
    }
}

